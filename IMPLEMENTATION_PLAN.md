# Windows Manus Clone 実装計画

## プロジェクト概要
Windows環境で動作するManus AIのクローンアプリケーションを開発します。Ollamaと連携し、Manusの自律型AIエージェント機能を再現します。

## 技術スタック
- **フロントエンド**: Next.js, React, TypeScript, Tailwind CSS, shadcn/ui
- **バックエンド**: Node.js
- **データベース**: SQLite + Prisma
- **AI連携**: Ollama API

## 実装フェーズ

### フェーズ1: プロジェクト構築とベース設定
- [x] リポジトリ作成
- [x] Next.jsプロジェクト初期化
- [x] TypeScript設定
- [x] ESLint, Prettier設定
- [x] Tailwind CSS, shadcn/ui設定
- [x] プロジェクト構造の確立

### フェーズ2: UI/UXコンポーネント
- [x] 基本UIコンポーネント設定 (button, toast等)
- [x] レイアウトコンポーネント実装
- [x] チャットインターフェース開発
- [x] 「Manusのコンピュータ」ウィンドウ実装
- [x] タスクリスト表示機能
- [x] 設定パネル（ライト/ダークモード、プロフィール編集）
- [x] フィードバックエリア

### フェーズ3: Ollama連携
- [x] Ollamaクライアント実装
- [x] Ollamaサービス層実装
- [x] Ollamaインストール検出機能
- [x] インストール済みモデル一覧表示
- [x] モデル選択UI
- [x] Ollama API連携機能のフロントエンド統合

### フェーズ4: コア機能実装
- [x] データベーススキーマ設計
- [x] Prismaクライアント設定
- [x] Windows環境サポートユーティリティ
- [x] マルチエージェントシステムアーキテクチャ設計
- [x] タスク分解と管理システム実装
- [x] サンドボックス環境APIの実装
- [x] ブラウザ自動化APIの部分実装
- [x] ブラウザ自動化コンポーネント完成
- [x] ブラウザUIコンポーネント実装
- [x] VSCode操作連携
- [x] ファイル生成と管理

### フェーズ5: 高度な機能
- [x] マルチモーダル入出力処理
  - [x] マルチモーダルプロセッサー基本クラス実装
  - [x] 画像処理サービス実装
  - [x] 音声処理サービス実装
  - [x] ドキュメント処理サービス実装
  - [x] マルチモーダル統合サービス実装
  - [x] マルチモーダルAPIエンドポイント実装
- [x] 自律的なタスク実行UIの実装
  - [x] タスク自動実行機能の実装
  - [x] 進捗可視化コンポーネントの実装
  - [x] タスク結果レポート機能の実装
- [x] ウェブサイト構築・デプロイ機能
  - [x] テンプレート選択UIの実装
  - [x] サイトビルダーコンポーネントの実装
  - [x] デプロイ設定ウィザードの実装
- [x] マルチモーダルUIコンポーネント
  - [x] ファイルアップロードコンポーネントの実装
  - [x] 画像プレビュー/編集コンポーネントの実装
  - [x] 音声プレイヤー/録音コンポーネントの実装
  - [x] ドキュメントビューアーコンポーネントの実装

### フェーズ6: Windows固有機能
- [x] サンドボックス環境のWindows実装完成
- [x] ファイルシステム操作のWindows対応
- [x] Windowsプロセス管理機能

### フェーズ7: テストと最適化
- [ ] ユニットテスト
- [ ] 統合テスト
- [ ] パフォーマンス最適化
- [ ] セキュリティ対策
- [ ] ドキュメント作成

## 現在の実装状況
- リポジトリ作成完了
- 基本的なNext.jsプロジェクト構造の設定完了
- TypeScript, ESLint, Prettierの設定完了
- Tailwind CSS, shadcn/uiの基本設定完了
- 基本的なUIコンポーネント(ボタン、トースト、カード、スイッチ、セレクト等)の実装完了
- レイアウトコンポーネント(サイドバー、ヘッダー、メインレイアウト)の実装完了
- チャットインターフェース(メッセージ、メッセージリスト、入力フォーム)の実装完了
- タスク管理機能(タスクカード、リスト、詳細ダイアログ)の実装完了
- 設定パネルの実装完了
- Manusコンピュータウィンドウ(AIアクション可視化)の実装完了
- ブラウザUIコンポーネントの実装完了
- Prismaスキーマ設計と初期設定完了
- Ollamaクライアントとサービス層の実装完了
- Ollamaインストール検出機能の実装完了
- インストール済みOllamaモデル一覧表示機能の実装完了
- Ollamaモデル管理ページの実装完了
- Windows環境サポートユーティリティの実装完了
- サンドボックス環境のサービス層実装完了
- AIエージェントコアモジュール実装完了
- ブラウザ自動化APIの部分実装完了
- フィードバックコンポーネントの実装完了
- フィードバックAPIエンドポイントの実装完了
- フィードバック管理用の管理者ページ実装完了
- VSCodeサービス層の実装完了
- VSCode APIエンドポイントの実装完了
- VSCodeエディタUIコンポーネントの実装完了
- エディタページの実装完了
- ファイル管理サービス層の実装完了
- ファイル管理APIエンドポイントの実装完了
- ファイル管理UIコンポーネントの実装完了
- ファイル管理ページの実装完了
- マルチモーダルプロセッサー基本クラスの実装完了
- 画像処理サービスの実装完了
- 音声処理サービスの実装完了
- ドキュメント処理サービスの実装完了
- マルチモーダル統合サービスの実装完了
- マルチモーダルAPIエンドポイント(画像、音声、ドキュメント)の実装完了
- マルチモーダルUIコンポーネントの実装完了
  - ファイルアップロードコンポーネントの実装完了
  - 画像プレビュー/編集コンポーネントの実装完了
  - 音声プレイヤー/録音コンポーネントの実装完了
  - ドキュメントビューアーコンポーネントの実装完了
- 自律的なタスク実行UIの実装完了
  - タスク自動実行機能の実装完了
  - 進捗可視化コンポーネントの実装完了
  - タスク結果レポート機能の実装完了
- ウェブサイト構築・デプロイ機能の実装完了
  - テンプレート選択UIの実装完了
  - サイトビルダーコンポーネントの実装完了
  - デプロイ設定ウィザードの実装完了
- Prismaスキーマのバグ修正完了
  - SQLiteがenum型をサポートしていない問題を解決
  - enum型を文字列型に変更しアプリケーション内で定数として再定義
  - タイプセーフなenum定数をアプリケーション全体でアクセス可能に設定
- shadcn/uiコンポーネントの追加実装完了
  - Dialog, Button, Toast, Toaster, Form, Input, Label, Textarea, Select, Radio Group コンポーネントを追加
  - フィードバックダイアログで使用される全てのUIコンポーネントの実装完了
- 依存関係の修正
  - `@radix-ui/react-radio-group` パッケージを追加し、RadioGroupコンポーネントの正常動作を確保
- Ollama連携機能の修正
  - 不足していた`ollama-client.ts`ファイルを作成し、Ollama API通信クラスを実装
  - Ollamaサービスとのやり取りを行うためのメソッドを実装（モデル一覧取得、テキスト生成、チャット、埋め込み取得など）
- Next.jsのクライアント/サーバーコンポーネント対応
  - `code-editor.tsx`ファイルに`'use client'`ディレクティブを追加し、useRefを使用可能に
  - エディタコンポーネントの修正完了（vscode-editor.tsx, editor-header.tsx, file-tree.tsx, file-tabs.tsx, output-panel.tsx）
  - 全てのエディタ関連コンポーネントにuse clientディレクティブを追加
  - getLanguageSample関数の実装と名前付きエクスポートへの変更
  - CodeEditorコンポーネントのPropsインターフェースを修正
  - コンポーネント間の連携の整合性確保
  - レイアウトコンポーネントの修正（header.tsx, main-layout.tsx, sidebar.tsx）
  - レイアウト関連コンポーネントに'use client'ディレクティブを追加
  - フィードバック関連コンポーネントに'use client'ディレクティブを追加（feedback-dialog.tsx, feedback-form.tsx）
  - ハイドレーションエラーを修正
  - `computer/page.tsx`に不足していたLucideアイコンのインポートを追加
  - Node.js依存の`ollama-installer.ts`をAPIルートに移行し、サーバーとクライアントの責務を分離
  - `/api/ollama/check`と`/api/ollama/start`のAPIルートを追加し、Node.js機能をサーバーサイドで実行
- 設定機能の強化
  - ローカルストレージを使用した設定管理システムの実装
  - 設定ページの更新（インストール済みOllamaモデルを動的に読み込み、選択可能に）
  - 選択したモデルを保存する機能の実装
  - 設定の保存状態を視覚的にフィードバック
  - Ollamaサービスの状態チェックと適切な通知機能の実装
- Windows固有機能の実装
  - Windowsファイルシステム操作機能の実装完了
    - パスの正規化、検証、解決などの基本ユーティリティ
    - ファイル一覧取得、読み込み、書き込み、削除などの操作
    - UNCパスやWindows特有のパス形式のサポート
  - Windowsプロセス管理機能の実装完了
    - プロセスの起動、停止、監視機能
    - プロセス一覧取得と詳細情報表示
    - プロセス優先度制御と出力キャプチャ
  - Windowsサンドボックス環境の実装完了
    - 安全なコマンド実行環境の提供
    - セッションベースのサンドボックス管理
    - ファイルシステム分離とプロセス制御の統合
  - Windows関連のAPIエンドポイント実装完了
    - ファイルシステム操作API（一覧/読み込み/書き込み）
    - プロセス管理API（起動/停止/一覧）
    - サンドボックス操作API
- チャット機能のOllama連携完了
  - Ollama APIを使用したチャットエンドポイント（`/api/ollama/chat`）の実装
  - チャットページでのAPI連携実装
  - エラーハンドリングとToastによる通知機能追加
  - 選択したモデルを利用したチャット応答生成
- バグ修正
  - モデル選択エラーの修正
    - UserSettingsテーブルの初期化不具合を修正
    - getSelectedOllamaModelメソッドでDBレコードが存在しない場合に自動生成するよう改善
  - コンピューターページのStopアイコンインポートエラー修正
    - Stopアイコンが見つからない問題を修正するためSquareアイコンを代わりに使用
    - importを個別に行うように変更し、バレルインポートの問題を回避
  - エディターページのTooltip実装
    - 欠落していたtooltip.tsxコンポーネントを追加実装
    - Radix UIのTooltipプリミティブを利用したUI実装
  - モデル選択機能の追加強化
    - Ollamaサービス層の詳細なログ出力追加とモデル選択ロジックの改善
    - モデル同期APIエンドポイントの強化
    - チャットAPIエンドポイントのエラー処理強化
    - アプリ起動時のモデル同期機能追加
    - チャットページにウェルカムメッセージとモデルエラー通知を追加

## 次のステップ
- テストと最適化
  - ユニットテスト
  - 統合テスト
  - パフォーマンス最適化
  - セキュリティ対策
  - ドキュメント作成

## 残りの実装タスク

### 最終フェーズ
1. **テストの実施**
   - ユニットテスト作成と実行
   - 統合テスト作成と実行
   - UIテスト作成と実行

2. **パフォーマンス最適化**
   - ボトルネック特定と改善
   - メモリ使用量の最適化
   - レンダリングパフォーマンスの向上

3. **セキュリティ対策**
   - 入力検証の強化
   - CSRF、XSS対策の実装
   - 権限管理の厳格化

4. **ドキュメント作成**
   - ユーザーガイド
   - 開発者ドキュメント
   - APIドキュメント
